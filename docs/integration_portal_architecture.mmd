flowchart TB  
  %% --- Clients ---  
  Portal[ğŸ’» Integration Portal<br/>]:::client
    
  %% --- OpenTelemetry & Jaeger (Tracing) ---
  subgraph OBS[Observability Stack]
    direction TB
    OTEL[ğŸ“¡ OpenTelemetry SDK<br/>Export â†’ OTLP]:::otel
    J_COLLECTOR[(ğŸ“¥ Jaeger Collector<br/>OTLP gRPC :4317)]:::infra
    J_UI[ğŸ§­ Jaeger UI<br/>:16686]:::ui
    OTEL --> J_COLLECTOR --> J_UI
  end

  %% --- SDKs ---
  UM_SDK[ğŸ“¦ UserManagement.SDK]:::sdk
  LOG_SDK[ğŸ“¦ CentralizedLogging.SDK]:::sdk

  %% --- APIs ---
  UM_API[ğŸ”‘ User Management API]:::api
  LOG_API[ğŸ“ Centralized Logging API]:::api

  %% --- Contracts ---
  UM_CONTRACTS[ğŸ“„ UserManagement.Contracts]:::contract
  LOG_CONTRACTS[ğŸ“„ Logging.Contracts]:::contract

  %% --- Databases ---
  UDB[(ğŸ—„ï¸ User DB)]:::db
  LDB[(ğŸ—„ï¸ Logging DB)]:::db

  %% --- Distributed Cache ---
  DRAGONFLY[(ğŸ§  DragonflyDB<br/>Cache: Tokens Â· Permissions Â· Roles)]:::cache

  %% --- Shared Observability Library ---
  SHARED[ğŸ§° Shared.Observability<br/>Middlewares<br/>ActivityTraceEnricher]:::lib

  %% --- Flows ---
  %% Clients use SDKs
  Portal --> UM_SDK --> UM_API
  Portal --> LOG_SDK --> LOG_API
  
  %% SDKs depend on contracts
  UM_SDK -.-> UM_CONTRACTS
  LOG_SDK -.-> LOG_CONTRACTS

  %% APIs also follow contracts
  UM_API -.-> UM_CONTRACTS
  LOG_API -.-> LOG_CONTRACTS

  %% APIs use DBs
  UM_API --> UDB
  LOG_API --> LDB

  %% APIs use DragonflyDB cache
  UM_API --> DRAGONFLY
  LOG_API --> DRAGONFLY
  Portal --> DRAGONFLY

  %% APIs use Shared Library (middlewares + enricher)
  UM_API -. uses .-> SHARED
  LOG_API -. uses .-> SHARED
  Portal -. uses .-> SHARED

  %% APIs emit traces via OTel to Jaeger
  UM_API -. uses .-> OTEL
  LOG_API -. uses .-> OTEL
  Portal -. uses .-> OTEL

  %% --- Styles ---
  classDef client fill:#f0f8ff,stroke:#007acc,stroke-width:2px,color:#000,font-weight:bold;
  classDef sdk fill:#fff5e6,stroke:#ff9900,stroke-width:2px,color:#000;
  classDef api fill:#e6ffe6,stroke:#339933,stroke-width:2px,color:#000;
  classDef contract fill:#f9f9f9,stroke:#555555,stroke-dasharray:3 3,color:#000;
  classDef db fill:#fff0f5,stroke:#cc0066,stroke-width:2px,color:#000;
  classDef cache fill:#f5f0ff,stroke:#7b2cbf,stroke-width:2px,color:#000,font-weight:bold;
  classDef lib fill:#eef7ff,stroke:#2b6cb0,stroke-width:2px,color:#000;
  classDef otel fill:#fffbea,stroke:#b7791f,stroke-width:2px,color:#000;
  classDef infra fill:#f5f5ff,stroke:#6b46c1,stroke-width:2px,color:#000;
  classDef ui fill:#f0fff4,stroke:#2f855a,stroke-width:2px,color:#000;